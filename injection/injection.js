console.log('%c h4cker Injected ', 'color: #fff; font-size: 40px; background-image: linear-gradient(to right, #d13939, #cd5a16, #be7900, #a49500, #80ad08, #5eaa33, #3ba64d, #00a062, #00825d, #006552, #0e4842, #1a2d2c); border: solid 1px #fff; border-radius: 28px; margin: 10px;');

var svg_1 = `<svg class="svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12.408 13.032c1.158-.062 2.854-.388 4.18-1.128.962-1.478 1.598-2.684 2.224-4-.86.064-1.852-.009-2.736-.257 1.068-.183 2.408-.565 3.422-1.216 1.255-1.784 2.185-4.659 2.502-6.429-2.874-.048-5.566.89-7.386 2.064-.614.7-1.146 2.389-1.272 3.283-.277-.646-.479-1.68-.242-2.542-1.458.767-2.733 1.643-4.177 2.86-.72 1.528-.834 3.29-.768 4.276-.391-.553-.915-1.63-.842-2.809-2.59 2.504-4.377 5.784-2.682 9.324 1.879-1.941 4.039-3.783 5.354-4.639-3.036 3.474-5.866 8.047-7.985 12.181l2.504-.786c1.084-1.979 2.059-3.684 2.933-4.905 3.229.423 6.096-2.168 8.028-4.795-.77.19-2.246-.058-3.057-.482z"/></svg>`;

var svg_2 = `<svg class="svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M17.831 7.672c1.096-1.096 2.875-1.865 3.688-3.106.892-1.362.508-3.192-.851-4.085-1.362-.892-3.187-.508-4.081.854-.842 1.286-.801 3.322-1.433 4.779-.817 1.882-3.553 2.116-6.698.474-1.727 3.352-4.075 6.949-6.456 9.874l2.263 1.484c1.018-.174 2.279-1.059 2.792-2.03-.04 1.167-.478 2.2-1.337 2.983l4.275 2.797c.546-.544 1.054-.976 1.616-1.345-.319.643-.532 1.324-.63 1.99l2.532 1.659c1.5-2.884 4.416-7.343 6.455-9.874-2.82-2.272-3.657-4.936-2.135-6.454zm1.762-5.545c.454.296.58.908.281 1.36-.294.457-.905.582-1.356.286-.456-.297-.582-.906-.284-1.36.295-.455.905-.583 1.359-.286zm-3.959 15.037l-8.225-5.386 1.616-2.469 8.221 5.387-1.612 2.468z"/></svg>`;

var svg_3 = `<?xml class="svg" version="1.0" encoding="iso-8859-1"?><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  height="24" width="24" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"> <g> <g> <path d="M507.353,245.245l-83.692-78.769c-4.289-4.039-10.57-5.141-15.98-2.803c-5.409,2.337-8.911,7.666-8.911,13.558v34.462 h-98.462v-98.462h34.462c5.893,0,11.221-3.502,13.558-8.911c2.336-5.409,1.236-11.69-2.803-15.98L266.755,4.647 C263.964,1.682,260.072,0,256,0c-4.072,0-7.964,1.682-10.755,4.647L166.476,88.34c-4.039,4.29-5.141,10.571-2.803,15.98 c2.337,5.409,7.666,8.911,13.558,8.911h34.462v98.462h-98.462v-34.462c0-5.893-3.502-11.221-8.911-13.558 c-5.41-2.337-11.69-1.236-15.98,2.803L4.647,245.245C1.682,248.036,0,251.928,0,256s1.682,7.964,4.647,10.755l83.692,78.769 c4.29,4.039,10.57,5.142,15.98,2.803c5.409-2.337,8.911-7.666,8.911-13.558v-34.462h98.462v98.462h-34.462 c-5.893,0-11.221,3.502-13.558,8.911c-2.336,5.41-1.236,11.69,2.803,15.98l78.769,83.692C248.036,510.318,251.928,512,256,512 c4.072,0,7.964-1.682,10.755-4.647l78.769-83.692c4.039-4.29,5.141-10.571,2.803-15.98c-2.337-5.409-7.666-8.911-13.558-8.911 h-34.462v-98.462h98.462v34.462c0,5.893,3.502,11.221,8.911,13.558c5.411,2.337,11.691,1.236,15.98-2.803l83.692-78.769 C510.318,263.964,512,260.072,512,256C512,251.928,510.318,248.035,507.353,245.245z M428.308,300.587v-15.049 c0-8.157-6.613-14.769-14.769-14.769h-128c-8.157,0-14.769,6.613-14.769,14.769v128c0,8.157,6.613,14.769,14.769,14.769h15.049 L256,475.682l-44.587-47.374h15.049c8.157,0,14.769-6.613,14.769-14.769v-128c0-8.157-6.613-14.769-14.769-14.769h-128 c-8.157,0-14.769,6.613-14.769,14.769v15.049L36.319,256l47.374-44.587v15.049c0,8.157,6.613,14.769,14.769,14.769h128 c8.157,0,14.769-6.613,14.769-14.769v-128c0-8.157-6.613-14.769-14.769-14.769h-15.049L256,36.319l44.587,47.374h-15.049 c-8.157,0-14.769,6.613-14.769,14.769v128c0,8.157,6.613,14.769,14.769,14.769h128c8.157,0,14.769-6.613,14.769-14.769v-15.049 L475.682,256L428.308,300.587z"/> </g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> </svg>`;

var svg_4 = `<svg class="svg" xmlns="http://www.w3.org/2000/svg" style="fill: yellow;" width="24" height="24" viewBox="0 0 24 24"><path d="M9 12l-4.463 4.969-4.537-4.969h3c0-4.97 4.03-9 9-9 2.395 0 4.565.942 6.179 2.468l-2.004 2.231c-1.081-1.05-2.553-1.699-4.175-1.699-3.309 0-6 2.691-6 6h3zm10.463-4.969l-4.463 4.969h3c0 3.309-2.691 6-6 6-1.623 0-3.094-.65-4.175-1.699l-2.004 2.231c1.613 1.526 3.784 2.468 6.179 2.468 4.97 0 9-4.03 9-9h3l-4.537-4.969z"/></svg>`;

var svg_5 = `<svg class="svg" xmlns="http://www.w3.org/2000/svg" style="fill: red;" width="24" height="24" viewBox="0 0 24 24"><path d="M16.143 2l5.857 5.858v8.284l-5.857 5.858h-8.286l-5.857-5.858v-8.284l5.857-5.858h8.286zm.828-2h-9.942l-7.029 7.029v9.941l7.029 7.03h9.941l7.03-7.029v-9.942l-7.029-7.029zm.932 11.667c-.127.328-1.695 3.888-2.096 4.786-.42.941-1.239 1.881-2.751 1.881h-2.627c-1.592 0-2.43-.945-2.43-2.596v-7.208c0-.956 1.316-.908 1.316-.044v3.16c0 .26.478.259.478 0v-5.079c0-.982 1.472-.957 1.472 0v4.795c0 .264.443.252.443-.005v-5.628c0-.957 1.457-.984 1.457 0v5.692c0 .254.459.261.459 0v-4.78c0-.905 1.596-.933 1.596 0v5.417c0 .331.327.384.45.131.118-.24.605-1.315.613-1.327.49-1.029 2.128-.404 1.619.805z"/></svg>`;

var svg_6 = `
<svg class="svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11.885 14.988l3.104-3.098.011.11c0 1.654-1.346 3-3 3l-.115-.012zm8.048-8.032l-3.274 3.268c.212.554.341 1.149.341 1.776 0 2.757-2.243 5-5 5-.631 0-1.229-.13-1.785-.344l-2.377 2.372c1.276.588 2.671.972 4.177.972 7.733 0 11.985-8.449 11.985-8.449s-1.415-2.478-4.067-4.595zm1.431-3.536l-18.619 18.58-1.382-1.422 3.455-3.447c-3.022-2.45-4.818-5.58-4.818-5.58s4.446-7.551 12.015-7.551c1.825 0 3.456.426 4.886 1.075l3.081-3.075 1.382 1.42zm-13.751 10.922l1.519-1.515c-.077-.264-.132-.538-.132-.827 0-1.654 1.346-3 3-3 .291 0 .567.055.833.134l1.518-1.515c-.704-.382-1.496-.619-2.351-.619-2.757 0-5 2.243-5 5 0 .852.235 1.641.613 2.342z"/></svg>`;

const H4ck3rToolbar = {
    // ...existing code... (SVGs, getToolbarSettings, buildToolbarHTML)

    // Initialization
    init: function() {
        console.log("H4ck3rToolbar init called");
        const toolbarSettings = this.getToolbarSettings();
        // Always build the full toolbar HTML
        const toolbar_html = this.buildToolbarHTML(toolbarSettings);

        var hide_toolbar_state = localStorage.getItem('h4ck3r.hide');
        if (hide_toolbar_state === null) {
            localStorage.setItem('h4ck3r.hide', 'true');
            hide_toolbar_state = 'true';
            console.log("Default toolbar state set to 'true' (shown)");
        }

        // Ensure previous toolbar is removed before adding new one
        $('.h4ckr-toolbar').remove();
        $('body').prepend(`<div class="h4ckr-toolbar"></div>`);
        const $toolbarContainer = $('.h4ckr-toolbar');

        // Always prepend the full toolbar HTML
        console.log("Rendering full toolbar");
        $toolbarContainer.prepend(toolbar_html);

        // Apply the hidden class based on the loaded state
        if (hide_toolbar_state === 'false') { // State is 'false' means it should be hidden
            console.log("Applying hidden class based on state");
            $('#toolbar_id_').addClass('h4ckr-toolbar-main--hidden');
        }

        this.attachEventListeners();

        // Make the toolbar draggable
        try {
            const toolbarElement = document.getElementById("toolbar_id_");
            if (toolbarElement && typeof dragElement === 'function') {
                 console.log("Making toolbar draggable");
                 dragElement(toolbarElement);
            } else if (!toolbarElement) {
                 console.warn('Toolbar element #toolbar_id_ not found for dragging.');
            } else if (typeof dragElement !== 'function') {
                 console.warn('dragElement function not found. Toolbar might not be draggable.');
            }
        } catch (err) {
            console.error("Error making toolbar draggable:", err);
        }

        // Set position
        const elmnt = document.getElementById("toolbar_id_");
        if (elmnt) {
            const topPos = localStorage.getItem('h4ck3r_position_top') ?? '10px';
            const leftPos = localStorage.getItem('h4ck3r_position_bottom') ?? '0px'; // Key is still 'bottom'
            elmnt.style.top = topPos;
            elmnt.style.left = leftPos;
            // Apply centering transform if left is 50%
            if (leftPos === '50%') {
                elmnt.style.transform = 'translateX(-50%)';
            } else {
                // Ensure no translateX transform if not centered (unless hidden)
                if (!elmnt.classList.contains('h4ckr-toolbar-main--hidden')) {
                    elmnt.style.transform = 'translateX(0)';
                }
            }
            console.log(`Toolbar position set: top=${topPos}, left=${leftPos}, transform=${elmnt.style.transform}`);

            // Re-apply hidden class if needed (init might run after state change)
            if (localStorage.getItem('h4ck3r.hide') === 'false') {
                elmnt.classList.add('h4ckr-toolbar-main--hidden');
                // Ensure correct hiding transform is applied
                elmnt.style.transform = 'translateX(-85%)';
                console.log("Applied hidden class and transform during init");
            }
        }

        // Hot reload logic
        if (toolbarSettings.reload) {
            this.setupHotReload();
        } else {
             $('#h4ckr-hot-reload').parent().hide();
             console.log("Hot reload button hidden due to settings.");
        }
        console.log("H4ck3rToolbar init finished");
    },

    // Event Listeners
    attachEventListeners: function() {
        $(document).off('click.h4ck3r');
        console.log("Attaching event listeners");

        $(document).on('click.h4ck3r', '.h4ckr-fill', (e) => { console.log("Fill clicked"); this.fillAllForms(e); });
        $(document).on('click.h4ck3r', '.h4ckr-reset', (e) => { console.log("Reset clicked"); this.resetAllForms(e); });
        // Use the same button (.h4c3r_hide) for both hiding and showing
        $(document).on('click.h4ck3r', '.h4ckr-hide', (e) => { console.log("Toggle Visibility clicked"); this.toggleVisibility(e); });
        $(document).on('click.h4ck3r', '#h4ckr-hot-reload span.h4ckr-hot-reload', (e) => { console.log("Hot Reload clicked"); this.toggleHotReload(e); });

        console.log("Event listeners attached");
    },

    // Combined toggle function
    toggleVisibility: function(e) {
        const toolbarElement = $('#toolbar_id_');
        const currentState = localStorage.getItem('h4ck3r.hide');

        if (currentState === 'true') { // Currently shown, so hide it
            console.log("Hiding toolbar");
            localStorage.setItem('h4ck3r.hide', 'false');
            toolbarElement.addClass('h4ckr-toolbar-main--hidden');
            // Apply hiding transform explicitly
            toolbarElement.css('transform', 'translateX(-85%)');
        } else { // Currently hidden, so show it
            console.log("Showing toolbar");
            localStorage.setItem('h4ck3r.hide', 'true');
            toolbarElement.removeClass('h4ckr-toolbar-main--hidden');
            // Re-apply position and centering transform when showing
            const topPos = localStorage.getItem('h4ck3r_position_top') ?? '10px';
            const leftPos = localStorage.getItem('h4ck3r_position_bottom') ?? '0px';
            let transform = 'translateX(0)'; // Default transform when shown
            if (leftPos === '50%') {
                transform = 'translateX(-50%)'; // Centering transform
            }
            toolbarElement.css({
                top: topPos,
                left: leftPos,
                transform: transform
            });
        }
    },

    getToolbarSettings: function() {
        return {
            fill: localStorage.getItem('h4ck3r.toolbar.fill') !== 'false',
            reset: localStorage.getItem('h4ck3r.toolbar.reset') !== 'false',
            hideToggle: localStorage.getItem('h4ck3r.toolbar.hideToggle') !== 'false',
            reload: localStorage.getItem('h4ck3r.toolbar.reload') !== 'false',
            jwtDecoder: localStorage.getItem('h4ck3r.toolbar.jwtDecoder') !== 'false',
        };
    },

    buildToolbarHTML: function(settings) {
        let html = `<div class="h4ckr-toolbar-main" id="toolbar_id_">`;

        if (settings.fill) {
            html += `
              <div class="h4ckr-toolbar-item h4ckr-fill">
                <span>${svg_1}</span>
              </div>`;
        }
        if (settings.reset) {
            html += `
              <div class="h4ckr-toolbar-item">
                <span class="h4ckr-reset">${svg_2}</span>
              </div>`;
        }
        if (settings.hideToggle) {
            html += `
              <div class="h4ckr-toolbar-item h4ckr-hide">
                <span>${svg_6}</span>
              </div>`;
        }
        if (settings.reload) {
            html += `
              <div class="h4ckr-toolbar-item" id="h4ckr-hot-reload">
                <span class="h4ckr-hot-reload">${svg_4}</span>
              </div>`;
        }

        // Add a new toolbar item for JWT Decoder
        if (settings.jwtDecoder) {
            html += `
              <div class="h4ckr-toolbar-item h4ckr-jwt_decoder">
                <span>
                  <svg class="svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                  </svg>
                </span>
              </div>`;
        }

        html += `
               <div class="h4ckr-toolbar-item" id="h4ckr-header">
                <span class="h4ckr-drag">${svg_3}</span>
              </div>
            </div>`;
        return html;
    },

    setupHotReload: function() {
        console.log("Setting up hot reload functionality");

        const reloadConfig = JSON.parse(localStorage.getItem('h4ck3r.reload')) || { seconds: 5000, do: false };

        if (reloadConfig.do) {
            console.log(`Hot reload enabled. Reloading every ${reloadConfig.seconds} milliseconds.`);
            setInterval(() => {
                window.location.reload();
            }, reloadConfig.seconds);
        } else {
            console.log("Hot reload is disabled.");
        }

        // Update the reload icon color based on the auto-reload state
        $('#h4ckr-hot-reload span.h4ckr-hot-reload').css('fill', reloadConfig.do ? 'yellow' : 'white');
    },

    // Function to toggle the auto-reload feature
    toggleHotReload: function(e) {
        const reloadConfig = JSON.parse(localStorage.getItem('h4ck3r.reload')) || { seconds: 5000, do: false };

        if (reloadConfig.do) {
            console.log('%c Hot reload disabled ', 'color: #fff; font-size: 40px; background-color: red;');
            $('.h4ckr-hot-reload').html(svg_4).css('fill', 'white'); // Update icon to white
            reloadConfig.do = false;
        } else {
            console.log('%c Hot reload enabled ', 'color: #fff; font-size: 40px; background-color: green;');
            $('.h4ckr-hot-reload').html(svg_5).css('fill', 'yellow'); // Update icon to yellow
            reloadConfig.do = true;
        }

        localStorage.setItem('h4ck3r.reload', JSON.stringify(reloadConfig));

        if (reloadConfig.do) {
            window.location.reload();
        }
    },

    // ... rest of the code (setupHotReload, toggleHotReload, form filling methods, utilities) ...
};

// Initialize the toolbar if needed
(function () {
    var toolbar_needed = localStorage.getItem('h4ck3r.toolbar.needed') !== 'false'; // Default true
    if (toolbar_needed) {
        console.log("Toolbar injection is enabled, initializing...");
        // Explicitly bind 'this' to H4ck3rToolbar when calling init
        H4ck3rToolbar.init.call(H4ck3rToolbar);
    } else {
        console.log('%c h4ck3r toolbar injection disabled via settings ', 'color: #ffcc00; font-size: 14px;');
    }
})();

// dragable.js needs to be loaded before this script or dragElement needs to be defined globally.
// Ensure dragElement function exists and handles potential errors gracefully.
function dragElement(elmnt) {
  // Basic implementation if dragable.js is missing (replace with actual content if available)
  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
  const header = elmnt.querySelector("#h4ckr-header") || elmnt; // Use header if exists, else the whole element

  header.onmousedown = dragMouseDown;

  function dragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
  }

  function closeDragElement() {
    // stop moving when mouse button is released:
    document.onmouseup = null;
    document.onmousemove = null;
    // Save position
    localStorage.setItem('h4ck3r_position_top', elmnt.style.top);
    localStorage.setItem('h4ck3r_position_left', elmnt.style.left); // Corrected key name
    console.log(`Toolbar position saved: top=${elmnt.style.top}, left=${elmnt.style.left}`);
  }
}

(function () {
    // Check the setting for whether toolbar injection is needed *at all*
    var toolbar_needed = localStorage.getItem('h4ck3r.toolbar.needed') !== 'false'; // Default true

    if (toolbar_needed) {
        H4ck3rToolbar.init.call(H4ck3rToolbar);
    } else {
        console.log('%c h4ck3r toolbar injection disabled via settings ', 'color: #ffcc00; font-size: 14px;');
    }

})()


$('.h4ckr-fill').on('click', (e) => {
    fill_email();
    fill_text();
    fill_tel();
    fill_text_area();
    fill_select();
    fill_checkbox();
    fill_password();
    fill_radio(); // Added radio button support
})

$('.h4ckr-reset').on('click', (e) => {

    $("input").val('');
    $("textarea").val('');

})

$('.h4ckr-hide').on('click', (e) => {

    console.log(e);


    localStorage.setItem('h4ck3r.hide', 1);

    $('.h4ckr-toolbar').remove();
    H4ck3rToolbar.init.call(H4ck3rToolbar);

    localStorage.setItem('h4ck3r_position_top', '9px')
    localStorage.setItem('h4ck3r_position_bottom', '-65px')

    window.location.reload()

})

$('.h4c3r_show').on('click', (e) => {

    console.log(e);

    localStorage.setItem('h4ck3r.hide', 0);

    $('.h4ckr-toolbar').remove();
    H4ck3rToolbar.init.call(H4ck3rToolbar);
    window.location.reload()


})

// Update the reload icon color dynamically when toggling auto-reload
$('#h4ckr-hot-reload').on('click', (e) => {
    var reload_config = localStorage.getItem('h4ck3r.reload');
    reload_config = JSON.parse(reload_config);

    console.log('click', reload_config);
    if (reload_config?.do == true) {
        console.log('%c hot reload disabled ', 'color: #fff; font-size: 40px; background-color: red;');

        $('.h4ckr-hot-reload').html(svg_4);
        $('.h4ckr-hot-reload').css('fill', 'white'); // Set icon color to white

        config = { seconds: 5000, do: false };
        localStorage.setItem('h4ck3r.reload', JSON.stringify(config));

    } else {
        console.log('%c hot reload enabled ', 'color: #fff; font-size: 40px; background-color: red;');

        $('.h4ckr-hot-reload').html(svg_5);
        $('.h4ckr-hot-reload').css('fill', 'yellow'); // Set icon color to yellow

        config = { seconds: 5000, do: true };
        localStorage.setItem('h4ck3r.reload', JSON.stringify(config));

        window.location.reload();
    }
});

// Set the reload icon color based on the value in localStorage
const reloadConfig = JSON.parse(localStorage.getItem('h4ck3r.reload')) || { do: false };
$('#h4ckr-hot-reload span.h4ckr-hot-reload').css('fill', reloadConfig.do ? 'yellow' : 'white');

const fill_email = function () {

    var sample_email = random_string() + '@yopmail.com';

    $("input[type='text']").each((i) => {

        var elm = $("input[type='email']")[i];

        $(elm).val(sample_email);
        $(elm).trigger('change');

    })

}

const fill_text = function () {

    $("input[type='text']").each((i) => {

        var elm = $("input[type='text']")[i];
        var str_len = 10;

        var max_length = $(elm).attr('maxlength');

        var minlength = $(elm).attr('minlength');

        if (minlength) {
            str_len = minlength + 1;
        }

        if (max_length) {
            str_len = max_length - 1;
        }

        var sample_string = random_string(str_len);

        $(elm).val(sample_string);
        $(elm).trigger('change');

    })

}

const fill_tel = function () {

    $("input[type='tel']").each((i) => {

        var elm = $("input[type='tel']")[i];

        var sample_string = '9' + random_number(9);

        $(elm).val(sample_string);
        $(elm).trigger('change');

    })

}

const fill_number = function () {

    $("input[type='number']").each((i) => {

        var elm = $("input[type='number']")[i];

        var str_len = 3;

        var max_length = $(elm).attr('min').length;

        var minlength = $(elm).attr('max').length;

        if (minlength) {
            str_len = minlength;
        }

        if (max_length) {
            str_len = max_length;
        }

        var sample_string = random_number(str_len);

        $(elm).val(sample_string);
        $(elm).trigger('change');

    })

}

const fill_text_area = function () {

    $("textarea").each((i) => {

        var elm = $("textarea")[i];
        var str_len = 50;

        var max_length = $(elm).attr('maxlength');

        var minlength = $(elm).attr('minlength');

        if (minlength) {
            str_len = minlength + 1;
        }

        if (max_length) {
            str_len = max_length - 1;
        }

        var sample_string = random_string(str_len);

        $(elm).html(sample_string);
        $(elm).trigger('change');

    })

}

function fill_select() {

    $("select").each((i) => {

        var elm = $("select")[i];
        var $options = $(elm).find('option');
        var random_val = ~~(Math.random() * $options.length);
        var option = $(elm).find('option')[random_val];
        $(elm).val($(option).val());
        $(elm).trigger('change');


    });

}

function fill_checkbox() {

    $("input[type='checkbox']").each((i) => {

        var elm = $("input[type='checkbox']")[i];
        $(elm).prop("checked", true);
        $(elm).trigger('change');


    });

}

function fill_password() {

    $("input[type='password']").each((i) => {

        var elm = $("input[type='password']")[i];
        $(elm).val("#Admin123");
        $(elm).trigger('change');


    });

}

function fill_radio() {
    $("input[type='radio']").each((i, group) => {
        const name = $(group).attr('name');
        if (name) {
            const radios = $(`input[name='${name}']`);
            const randomIndex = Math.floor(Math.random() * radios.length);
            radios.eq(randomIndex).prop('checked', true).trigger('change');
        }
    });
}

function random_string(length = 8) {
    var result = '';
    var characters = 'abcdefghijklmnopqrstuvwxyz';
    var charactersLength = characters.length;
    for (var i = 0; i < length; i++) {
        result += characters.charAt(Math.floor(Math.random() * charactersLength));
    }
    return result;
}

function random_number(length = 8) {
    var result = '';
    var characters = '0123456789';
    var charactersLength = characters.length;
    for (var i = 0; i < length; i++) {
        result += characters.charAt(Math.floor(Math.random() * charactersLength));
    }
    return result;
}

function take_screenshot() {

    $('.h4ckr-toolbar').hide();

    html2canvas(document.body).then(function (canvas) {
        document.body.appendChild(canvas);
    })
        .then(() => {
            var canvas = document.querySelector('canvas');
            canvas.style.display = 'none';
            var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
            var a = document.createElement("a");
            a.setAttribute('download', 'myImage.png');
            a.setAttribute('href', image);
            a.click();
        });

    $('.h4ckr-toolbar').show();

}

// Enhanced JWT Decoder to automatically fetch tokens from localStorage, sessionStorage, and cookies
$('.h4ckr-jwt_decoder').on('click', () => {
    let token = null;

    // Check localStorage for JWT tokens
    for (let key in localStorage) {
        if (localStorage.hasOwnProperty(key) && localStorage[key].includes('.')) {
            const parts = localStorage[key].split('.');
            if (parts.length === 3) {
                token = localStorage[key];
                console.log(`JWT found in localStorage under key: ${key}`);
                break;
            }
        }
    }

    // Check sessionStorage for JWT tokens if not found in localStorage
    if (!token) {
        for (let key in sessionStorage) {
            if (sessionStorage.hasOwnProperty(key) && sessionStorage[key].includes('.')) {
                const parts = sessionStorage[key].split('.');
                if (parts.length === 3) {
                    token = sessionStorage[key];
                    console.log(`JWT found in sessionStorage under key: ${key}`);
                    break;
                }
            }
        }
    }

    // Check cookies for JWT tokens if not found in storage
    if (!token) {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
            const value = cookie.split('=')[1]?.trim();
            if (value && value.includes('.')) {
                const parts = value.split('.');
                if (parts.length === 3) {
                    token = value;
                    console.log(`JWT found in cookies: ${cookie}`);
                    break;
                }
            }
        }
    }

    // If no token is found, notify the user
    if (!token) {
        alert('No JWT token found in localStorage, sessionStorage, or cookies.');
        return;
    }

    try {
        const parts = token.split('.');
        if (parts.length !== 3) {
            throw new Error('Invalid JWT format. Token must have 3 parts separated by dots.');
        }

        const decodeBase64 = (str) => decodeURIComponent(atob(str).split('').map(c => {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));

        const header = JSON.parse(decodeBase64(parts[0]));
        const payload = JSON.parse(decodeBase64(parts[1]));

        console.log('Decoded JWT Header:', header);
        console.log('Decoded JWT Payload:', payload);

        alert(`Header: ${JSON.stringify(header, null, 2)}\n\nPayload: ${JSON.stringify(payload, null, 2)}`);
    } catch (error) {
        alert(`Error decoding JWT: ${error.message}`);
    }
});
